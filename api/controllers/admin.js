const pool = require('../../config/db');
const bcrypt = require('bcrypt');
const jwt = require('jsonwebtoken');

module.exports = () => {
  const controller = {}

  controller.getUsers = (req, res) => {
    pool.getConnection((err, connection) => {
      connection.query(`SELECT * FROM user WHERE id = "${req.userId}"`,
        function(error, results, fields) {
          if(results[0]) {
            if(results[0].is_admin === null) {
              res.status(401).json({auth: false, message: "The user is not an admin."})
            } else {
              connection.query(`SELECT * FROM user`, function(error, results, fields) {
                res.status(200).json(results);
              })
            }
          }
          connection.release();
      });
    });
  }

  return controller;
}